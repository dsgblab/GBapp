import{_ as z}from"./AppLayout-af5e8264.js";import{_ as F}from"./TextInput-3f1c3dfe.js";import{_ as E}from"./Checkbox-c351540d.js";import{_ as P}from"./InputLabel-3dcfe30a.js";import{u as N,a as C,e as O,r as M,m as b,s as S}from"./i18n-validators-d6bc6beb.js";import{_ as D,i as T,k as j,a0 as R,I as h,o as t,c as G,w as c,a as s,t as m,b as r,f as x,n as w,e as o,F as u,g as p,h as g}from"./app-024b1c19.js";import{_ as H}from"./CustomButton-14dd6be1.js";import{a as J}from"./DialogModal-9d70fdc7.js";import{_ as K}from"./SecondaryButton-ae2da2c3.js";import{_ as Q}from"./PrimaryButton-3ed0f677.js";import W from"./Index-1fa1a204.js";const X={computed:{report(){return W}},setup(){return{v$:N()}},components:{PrimaryButton:Q,SecondaryButton:K,DialogModal:J,FontAwesomeIcon:T,CustomButton:H,Link:j,InputLabel:P,Checkbox:E,TextInput:F,AppLayout:z},props:{user:Object,roles:Array,permissions:Array,reports:Array,filters:Array},validations(){return{form:{id:{required:C},name:{required:C},username:{required:C},email:{required:C,email:O},password:{requiredIf:M(this.form.change_password),minLength:b(8)},confirm_password:{requiredIf:M(this.form.change_password),sameAs:S(this.form.password),minLength:b(8)},reports:{minLength:b(1)},permissions:{requiredIf:M(this.form.roles.length<1),minLength:b(1)},roles:{requiredIf:M(this.form.permissions.length<1),minLength:b(1)}}}},data(){return{form:{id:this.user.id,type:this.user.type,name:this.user.name,username:this.user.username,email:this.user.email,change_password:!1,password:"",confirm_password:"",reports:[],permissions:this.user.permissions.map(d=>d.name),roles:this.user.roles.map(d=>d.name)},filterModal:{open:!1,form:{user_id:"",report_id:"",filters:[]}},reportModal:{open:!1,form:{user_id:"",reports:[]}}}},methods:{openFilterModal(d,l){this.filterModal={open:!0,form:{user_id:this.user.id,report_id:d,filters:l.map(f=>f.id)}}},closeModal(){this.filterModal={open:!1,form:{user_id:"",report_id:"",filters:[]}},this.reportModal={open:!1,form:{user_id:"",reports:[]}}},updateFilter(){axios.post(route("user.report.update-filters"),this.filterModal.form).then(()=>{this.$swal({icon:"success",title:"Actualizado",text:"Filtros actualizados con éxito",toast:!0,position:"top-end",showConfirmButton:!1,timer:5e3,timerProgressBar:!0}),this.closeModal(),R.visit(route("users.edit",this.user.id))}).catch(d=>{this.$swal({icon:"error",title:"ERROR",text:d.response.data})})},openReportModal(){this.reportModal={open:!0,form:{user_id:this.user.id,reports:this.user.reports.map(d=>d.id)}}},updateReports(){axios.post(route("user.update-reports"),this.reportModal.form).then(()=>{this.$swal({icon:"success",title:"Actualizado",text:"Reportes actualizados con éxito",toast:!0,position:"top-end",showConfirmButton:!1,timer:5e3,timerProgressBar:!0}),this.closeModal(),R.visit(route("users.edit",this.user.id))}).catch(d=>{this.$swal({icon:"error",title:"ERROR",text:d.response.data})})},updateUser(){this.v$.form.$touch(),this.v$.form.$invalid?this.$swal({icon:"error",title:"ERROR",text:"Verifica que toda la información este correctamente diligenciada"}):axios.put(route("users.update",this.form.id),this.form).then(()=>{this.$swal({icon:"success",title:"Usuario Actualizado",text:"Usuario actualizado con éxito",toast:!0,position:"top-end",showConfirmButton:!1,timer:5e3,timerProgressBar:!0}),R.visit(route("users.edit",this.user.id))}).catch(d=>{this.$swal({icon:"error",title:"ERROR",text:d.response.data})})},updateShowDashboard(d,l){axios.post(route("user.report.set-default"),{user_id:this.user.id,report_id:d,state:l}).then(()=>{this.$swal({icon:"success",title:"Actualizado",text:"Reporte actualizado con exito",toast:!0,position:"top-end",showConfirmButton:!1,timer:5e3,timerProgressBar:!0}),R.visit(route("users.edit",this.user.id))}).catch(f=>{this.$swal({icon:"error",title:"ERROR",text:f.response.data})})}}},Y={class:"flex flex-row"},Z={class:"font-semibold text-xl text-gray-800 leading-tight"},ee={class:"py-10"},se={class:"max-w-8xl mx-10 sm:px-8 lg:px-8"},te={class:"overflow-x-auto sm:-mx-6 lg:-mx-8"},oe={class:"py-2 align-middle inline-block min-w-full"},re={class:"shadow overflow-hidden border-b border-gray-200 sm:rounded-lg bg-white p-5"},ie={class:"grid grid-cols-3 gap-5"},le={key:0,class:"mt-1"},ae={key:0,class:"mt-1"},ne={key:0,class:"mt-1"},de={class:"block"},ce={class:"flex items-center"},me=s("span",{class:"ml-2 text-sm text-gray-600"},"Cambiar contraseña",-1),ue={key:0,class:"mt-1"},fe={key:0,class:"mt-1"},pe={class:"border rounded-lg p-4 col-span-3"},_e=s("legend",null,"Roles disponibles",-1),he={class:"grid grid-cols-5 gap-5"},xe={class:"flex items-center"},ge={class:"ml-2"},ve={key:0,class:"mt-1"},we={class:"border rounded-lg p-4 col-span-3"},ke=s("legend",null,"Permisos disponibles",-1),ye={class:"grid grid-cols-5 gap-5"},be={class:"flex items-center"},Ce={class:"ml-2"},Me={key:0,class:"mt-1"},Re={class:"shadow overflow-hidden border-b border-gray-200 sm:rounded-lg mt-5 bg-white"},Be={class:"min-w-full divide-y divide-gray-200"},Ve={class:"bg-gray-50"},Ae=s("tr",{class:"border-b"},[s("th",{scope:"col",colspan:"4",class:"px-6 py-3 text-left text-sm font-medium text-gray-500 uppercase tracking-wider"}," Reportes ")],-1),Le={scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},Ue=s("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Mostrar en dashboard ",-1),qe=s("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Reporte ",-1),Ie=s("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Filtros ",-1),$e={class:"bg-white divide-y divide-gray-200"},ze={class:"px-6 py-4 text-center text-sm font-medium"},Fe={class:"flex flex-row"},Ee={class:"px-6 py-4 text-left text-sm font-medium"},Pe={class:"px-6 py-4 text-left text-sm font-medium"},Ne={class:"px-6 py-4 text-left text-sm font-medium"},Oe={key:1,class:"text-xs font-semibold inline-block py-1 px-2 rounded text-red-600 bg-red-200 uppercase last:mr-0 mr-1"},Se={key:1},De=s("td",{class:"px-6 py-4 text-sm font-medium text-center text-red-500",colspan:"4"}," Ningún registro agregado… ",-1),Te=[De],je={class:"grid grid-cols-2 gap-5"},Ge={class:"flex items-center"},He={class:"ml-2"},Je={class:"grid grid-cols-2 gap-5"},Ke={class:"flex items-center"},Qe={class:"ml-2"};function We(d,l,f,n,a,_){const B=h("font-awesome-icon"),q=h("Link"),k=h("InputLabel"),y=h("TextInput"),v=h("Checkbox"),V=h("PrimaryButton"),A=h("CustomButton"),L=h("SecondaryButton"),U=h("DialogModal"),I=h("AppLayout");return t(),G(I,{title:`Editar usuario ${f.user.name}`},{header:c(()=>[s("div",Y,[s("h2",Z," Editar usuario "+m(f.user.name),1)])]),actions:c(()=>[r(q,{href:d.route("users.index"),class:"inline-flex items-center px-4 py-2 bg-gray-800 border border-transparent rounded-md font-semibold text-xs text-white uppercase tracking-widest hover:bg-gray-700 focus:bg-gray-700 active:bg-gray-900 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition ease-in-out duration-150"},{default:c(()=>[r(B,{class:"mr-2",icon:"arrow-left"}),x(" Atrás ")]),_:1},8,["href"])]),default:c(()=>[s("div",ee,[s("div",se,[s("div",te,[s("div",oe,[s("div",re,[s("div",ie,[s("div",null,[r(k,{value:"Nombre"}),r(y,{modelValue:a.form.name,"onUpdate:modelValue":l[0]||(l[0]=e=>a.form.name=e),type:"text",class:w(["mt-1 block w-full",{"border-red-500":n.v$.form.name.$error}]),required:"",autocomplete:"off"},null,8,["modelValue","class"]),n.v$.form.name.$error?(t(),o("ul",le,[(t(!0),o(u,null,p(n.v$.form.name.$errors,(e,i)=>(t(),o("li",{class:"text-red-500",key:i},m(e.$message),1))),128))])):g("",!0)]),s("div",null,[r(k,{value:"Usuario"}),r(y,{modelValue:a.form.username,"onUpdate:modelValue":l[1]||(l[1]=e=>a.form.username=e),type:"text",class:w(["mt-1 block w-full",{"border-red-500":n.v$.form.username.$error}]),required:"",autocomplete:"off"},null,8,["modelValue","class"]),n.v$.form.username.$error?(t(),o("ul",ae,[(t(!0),o(u,null,p(n.v$.form.username.$errors,(e,i)=>(t(),o("li",{class:"text-red-500",key:i},m(e.$message),1))),128))])):g("",!0)]),s("div",null,[r(k,{value:"Correo electrónico"}),r(y,{modelValue:a.form.email,"onUpdate:modelValue":l[2]||(l[2]=e=>a.form.email=e),type:"email",class:w(["mt-1 block w-full",{"border-red-500":n.v$.form.email.$error}]),required:"",autocomplete:"off"},null,8,["modelValue","class"]),n.v$.form.email.$error?(t(),o("ul",ne,[(t(!0),o(u,null,p(n.v$.form.email.$errors,(e,i)=>(t(),o("li",{class:"text-red-500",key:i},m(e.$message),1))),128))])):g("",!0)]),s("div",de,[s("label",ce,[r(v,{checked:a.form.change_password,"onUpdate:checked":l[3]||(l[3]=e=>a.form.change_password=e),name:"change_password"},null,8,["checked"]),me])]),a.form.change_password?(t(),o(u,{key:0},[s("div",null,[r(k,{value:"Contraseña"}),r(y,{modelValue:a.form.password,"onUpdate:modelValue":l[4]||(l[4]=e=>a.form.password=e),type:"password",class:w(["mt-1 block w-full",{"border-red-500":n.v$.form.password.$error}]),required:"",autocomplete:"off"},null,8,["modelValue","class"]),n.v$.form.password.$error?(t(),o("ul",ue,[(t(!0),o(u,null,p(n.v$.form.password.$errors,(e,i)=>(t(),o("li",{class:"text-red-500",key:i},m(e.$message),1))),128))])):g("",!0)]),s("div",null,[r(k,{value:"Confirmar Contraseña"}),r(y,{modelValue:a.form.confirm_password,"onUpdate:modelValue":l[5]||(l[5]=e=>a.form.confirm_password=e),type:"password",class:w(["mt-1 block w-full",{"border-red-500":n.v$.form.confirm_password.$error}]),required:"",autocomplete:"off"},null,8,["modelValue","class"]),n.v$.form.confirm_password.$error?(t(),o("ul",fe,[(t(!0),o(u,null,p(n.v$.form.confirm_password.$errors,(e,i)=>(t(),o("li",{class:"text-red-500",key:i},m(e.$message),1))),128))])):g("",!0)])],64)):g("",!0),s("fieldset",pe,[_e,s("div",he,[(t(!0),o(u,null,p(f.roles,e=>(t(),o("div",xe,[r(v,{checked:a.form.roles,"onUpdate:checked":l[6]||(l[6]=i=>a.form.roles=i),value:e.name},null,8,["checked","value"]),s("div",ge,m(e.name),1)]))),256))]),n.v$.form.roles.$error?(t(),o("ul",ve,[(t(!0),o(u,null,p(n.v$.form.roles.$errors,(e,i)=>(t(),o("li",{class:"text-red-500",key:i},m(e.$message),1))),128))])):g("",!0)]),s("fieldset",we,[ke,s("div",ye,[(t(!0),o(u,null,p(f.permissions,e=>(t(),o("div",be,[r(v,{checked:a.form.permissions,"onUpdate:checked":l[7]||(l[7]=i=>a.form.permissions=i),value:e.name},null,8,["checked","value"]),s("div",Ce,m(e.name),1)]))),256))]),n.v$.form.permissions.$error?(t(),o("ul",Me,[(t(!0),o(u,null,p(n.v$.form.permissions.$errors,(e,i)=>(t(),o("li",{class:"text-red-500",key:i},m(e.$message),1))),128))])):g("",!0)])]),r(V,{onClick:_.updateUser,class:"mt-5"},{default:c(()=>[x(" Actualizar ")]),_:1},8,["onClick"])]),s("div",Re,[s("table",Be,[s("thead",Ve,[Ae,s("tr",null,[s("th",Le,[r(A,{class:"mr-2",onClick:_.openReportModal},{default:c(()=>[r(B,{icon:["far","pen-to-square"],class:"mr-1"}),x(" Modificar reportes ")]),_:1},8,["onClick"])]),Ue,qe,Ie])]),s("tbody",$e,[f.user.reports.length>0?(t(!0),o(u,{key:0},p(f.user.reports,e=>(t(),o("tr",null,[s("td",ze,[s("div",Fe,[r(A,{class:"mr-2",onClick:i=>_.openFilterModal(e.id,e.filters)},{default:c(()=>[r(B,{icon:["fas","filter"],class:"mr-1"}),x(" Filtros ")]),_:2},1032,["onClick"])])]),s("td",Ee,[r(v,{onChange:i=>_.updateShowDashboard(e.id,!e.pivot.show),value:e.pivot.show,checked:e.pivot.show===1},null,8,["onChange","value","checked"])]),s("td",Pe,m(e.name),1),s("td",Ne,[e.filters.length>0?(t(!0),o(u,{key:0},p(e.filters,(i,$)=>(t(),o("span",{class:w(["text-xs font-semibold inline-block py-1 px-2 rounded text-green-600 bg-green-200 uppercase last:mr-0 mr-1",{"ml-1":$>0}])},m(i.name),3))),256)):(t(),o("span",Oe," Ningún filtro agregado "))])]))),256)):(t(),o("tr",Se,Te))])])])])])])]),r(U,{show:a.filterModal.open,onClose:_.closeModal},{title:c(()=>[x(" Filtros "+m(f.reports.find(e=>e.id===a.filterModal.form.report_id).name),1)]),content:c(()=>[s("div",je,[(t(!0),o(u,null,p(f.filters,e=>(t(),o("div",Ge,[r(v,{checked:a.filterModal.form.filters,"onUpdate:checked":l[8]||(l[8]=i=>a.filterModal.form.filters=i),value:e.id},null,8,["checked","value"]),s("div",He,m(e.name),1)]))),256))])]),footer:c(()=>[r(L,{onClick:_.closeModal},{default:c(()=>[x(" Cancelar ")]),_:1},8,["onClick"]),r(V,{class:"ml-3",onClick:_.updateFilter},{default:c(()=>[x(" Actualizar ")]),_:1},8,["onClick"])]),_:1},8,["show","onClose"]),r(U,{show:a.reportModal.open,onClose:_.closeModal},{title:c(()=>[x(" Modificar reportes ")]),content:c(()=>[s("div",Je,[(t(!0),o(u,null,p(f.reports,e=>(t(),o("div",Ke,[r(v,{checked:a.reportModal.form.reports,"onUpdate:checked":l[9]||(l[9]=i=>a.reportModal.form.reports=i),value:e.id},null,8,["checked","value"]),s("div",Qe,m(e.name),1)]))),256))])]),footer:c(()=>[r(L,{onClick:_.closeModal},{default:c(()=>[x(" Cancelar ")]),_:1},8,["onClick"]),r(V,{class:"ml-3",onClick:_.updateReports},{default:c(()=>[x(" Actualizar ")]),_:1},8,["onClick"])]),_:1},8,["show","onClose"])]),_:1},8,["title"])}const ns=D(X,[["render",We]]);export{ns as default};
