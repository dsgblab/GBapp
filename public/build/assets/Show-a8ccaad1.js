import{_ as q}from"./AppLayout-3d5c8c3c.js";import{_ as I}from"./TextInput-3ad41c6b.js";import{_ as z}from"./Checkbox-37d4a236.js";import{_ as F}from"./InputLabel-ca4b48a2.js";import{u as S,a as C,e as D,r as M,m as b,s as E}from"./i18n-validators-1150f95e.js";import{i as P,k as N,I as h,o,c as O,w as c,a as s,t as m,b as r,D as T,a1 as j,n as k,e as t,F as u,h as f,f as g,g as x}from"./app-0e3e2a5c.js";import{_ as G}from"./CustomButton-ec1d3ddc.js";import{a as H}from"./DialogModal-0629bdaf.js";import{_ as J}from"./SecondaryButton-253bec48.js";import{_ as K}from"./PrimaryButton-6e2c4106.js";import Q from"./Report-7e025c99.js";import{_ as W}from"./_plugin-vue_export-helper-c27b6911.js";import"./DangerButton-2828376a.js";const X={computed:{report(){return Q}},setup(){return{v$:S()}},components:{PrimaryButton:K,SecondaryButton:J,DialogModal:H,FontAwesomeIcon:P,CustomButton:G,Link:N,InputLabel:F,Checkbox:z,TextInput:I,AppLayout:q},props:{user:Object,roles:Array,permissions:Array,reports:Array,filters:Array},validations(){return{form:{id:{required:C},name:{required:C},username:{required:C},email:{required:C,email:D},password:{requiredIf:M(this.form.change_password),minLength:b(8)},confirm_password:{requiredIf:M(this.form.change_password),sameAs:E(this.form.password),minLength:b(8)},reports:{minLength:b(1)},permissions:{requiredIf:M(this.form.roles.length<1),minLength:b(1)},roles:{requiredIf:M(this.form.permissions.length<1),minLength:b(1)}}}},data(){return{form:{id:this.user.id,type:this.user.type,name:this.user.name,username:this.user.username,email:this.user.email,change_password:!1,password:"",confirm_password:"",reports:[],permissions:this.user.permissions.map(d=>d.name),roles:this.user.roles.map(d=>d.name)},filterModal:{open:!1,form:{user_id:"",report_id:"",filters:[]}},reportModal:{open:!1,form:{user_id:"",reports:[]}}}},methods:{openFilterModal(d,l){this.filterModal={open:!0,form:{user_id:this.user.id,report_id:d,filters:l.map(p=>p.id)}}},closeModal(){this.filterModal={open:!1,form:{user_id:"",report_id:"",filters:[]}},this.reportModal={open:!1,form:{user_id:"",reports:[]}}},updateFilter(){axios.post(route("user.report.update-filters"),this.filterModal.form).then(()=>{this.$swal({icon:"success",title:"Actualizado",text:"Filtros actualizados con éxito",toast:!0,position:"top-end",showConfirmButton:!1,timer:5e3,timerProgressBar:!0}),this.closeModal(),this.$inertia.visit(route("users.show",this.user.id))}).catch(d=>{this.$swal({icon:"error",title:"ERROR",text:d.response.data})})},openReportModal(){this.reportModal={open:!0,form:{user_id:this.user.id,reports:this.user.reports.map(d=>d.id)}}},updateReports(){axios.post(route("user.update-reports"),this.reportModal.form).then(()=>{this.$swal({icon:"success",title:"Actualizado",text:"Reportes actualizados con éxito",toast:!0,position:"top-end",showConfirmButton:!1,timer:5e3,timerProgressBar:!0}),this.closeModal(),this.$inertia.visit(route("users.show",this.user.id))}).catch(d=>{this.$swal({icon:"error",title:"ERROR",text:d.response.data})})},updateUser(){this.v$.form.$touch(),this.v$.form.$invalid?this.$swal({icon:"error",title:"ERROR",text:"Verifica que toda la información este correctamente diligenciada"}):axios.put(route("users.update",this.form.id),this.form).then(()=>{this.$swal({icon:"success",title:"Usuario Actualizado",text:"Usuario actualizado con éxito",toast:!0,position:"top-end",showConfirmButton:!1,timer:5e3,timerProgressBar:!0}),this.$inertia.visit(route("users.show",this.user.id))}).catch(d=>{this.$swal({icon:"error",title:"ERROR",text:d.response.data})})},updateShowDashboard(d,l){axios.post(route("user.report.set-default"),{user_id:this.user.id,report_id:d,state:l}).then(()=>{this.$swal({icon:"success",title:"Actualizado",text:"Reporte actualizado con exito",toast:!0,position:"top-end",showConfirmButton:!1,timer:5e3,timerProgressBar:!0}),this.$inertia.visit(route("users.show",this.user.id),{preserveScroll:!0})}).catch(p=>{this.$swal({icon:"error",title:"ERROR",text:p.response.data})})}}},Y={class:"flex flex-row"},Z={class:"font-semibold text-xl text-gray-800 leading-tight"},ee={class:"py-12"},se={class:"max-w-8xl mx-6 sm:px-6 lg:px-8"},oe={class:"overflow-x-auto sm:-mx-6 lg:-mx-8"},te={class:"py-2 align-middle inline-block min-w-full"},re={class:"shadow overflow-hidden border-b border-gray-200 sm:rounded-lg bg-white p-5"},le={class:"grid grid-cols-3 gap-5"},ie=s("option",{value:"",disabled:"",selected:""},"Seleccione…",-1),ae=s("option",{value:"customer"},"Cliente",-1),ne=s("option",{value:"designer"},"Diseñador",-1),de=[ie,ae,ne],ce={key:0,class:"mt-1"},me={key:0,class:"mt-1"},ue={key:0,class:"mt-1"},fe={class:"block"},pe={class:"flex items-center"},_e=s("span",{class:"ml-2 text-sm text-gray-600"},"Cambiar contraseña",-1),he={key:0,class:"mt-1"},xe={key:0,class:"mt-1"},ge={class:"border rounded-lg p-4 col-span-3"},ve=s("legend",null,"Roles disponibles",-1),we={class:"grid grid-cols-5 gap-5"},ke={class:"flex items-center"},ye={class:"ml-2"},be={key:0,class:"mt-1"},Ce={class:"border rounded-lg p-4 col-span-3"},Me=s("legend",null,"Permisos disponibles",-1),Re={class:"grid grid-cols-5 gap-5"},Ve={class:"flex items-center"},Be={class:"ml-2"},Ae={key:0,class:"mt-1"},Ue={class:"shadow overflow-hidden border-b border-gray-200 sm:rounded-lg mt-5 bg-white"},$e={class:"min-w-full divide-y divide-gray-200"},Le={class:"bg-gray-50"},qe=s("tr",{class:"border-b"},[s("th",{scope:"col",colspan:"4",class:"px-6 py-3 text-left text-sm font-medium text-gray-500 uppercase tracking-wider"}," Reportes ")],-1),Ie={scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},ze=s("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Mostrar en dashboard ",-1),Fe=s("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Reporte ",-1),Se=s("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Filtros ",-1),De={class:"bg-white divide-y divide-gray-200"},Ee={class:"px-6 py-4 text-center text-sm font-medium"},Pe={class:"flex flex-row"},Ne={class:"px-6 py-4 text-left text-sm font-medium"},Oe={class:"px-6 py-4 text-left text-sm font-medium"},Te={class:"px-6 py-4 text-left text-sm font-medium"},je={key:1,class:"text-xs font-semibold inline-block py-1 px-2 rounded text-red-600 bg-red-200 uppercase last:mr-0 mr-1"},Ge={class:"grid grid-cols-2 gap-5"},He={class:"flex items-center"},Je={class:"ml-2"},Ke={class:"grid grid-cols-2 gap-5"},Qe={class:"flex items-center"},We={class:"ml-2"};function Xe(d,l,p,n,i,_){const v=h("InputLabel"),y=h("TextInput"),w=h("Checkbox"),R=h("PrimaryButton"),V=h("font-awesome-icon"),B=h("CustomButton"),A=h("SecondaryButton"),U=h("DialogModal"),$=h("AppLayout");return o(),O($,{title:`Editar usuario ${p.user.name}`},{header:c(()=>[s("div",Y,[s("h2",Z," Editar usuario "+m(p.user.name),1)])]),default:c(()=>[s("div",ee,[s("div",se,[s("div",oe,[s("div",te,[s("div",re,[s("div",le,[s("div",null,[r(v,{value:"Tipo"}),T(s("select",{class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full","onUpdate:modelValue":l[0]||(l[0]=e=>i.form.type=e)},de,512),[[j,i.form.type]])]),s("div",null,[r(v,{value:"Nombre"}),r(y,{modelValue:i.form.name,"onUpdate:modelValue":l[1]||(l[1]=e=>i.form.name=e),type:"text",class:k(["mt-1 block w-full",{"border-red-500":n.v$.form.name.$error}]),required:"",autocomplete:"off"},null,8,["modelValue","class"]),n.v$.form.name.$error?(o(),t("ul",ce,[(o(!0),t(u,null,f(n.v$.form.name.$errors,(e,a)=>(o(),t("li",{class:"text-red-500",key:a},m(e.$message),1))),128))])):g("",!0)]),s("div",null,[r(v,{value:"Usuario"}),r(y,{modelValue:i.form.username,"onUpdate:modelValue":l[2]||(l[2]=e=>i.form.username=e),type:"text",class:k(["mt-1 block w-full",{"border-red-500":n.v$.form.username.$error}]),required:"",autocomplete:"off"},null,8,["modelValue","class"]),n.v$.form.username.$error?(o(),t("ul",me,[(o(!0),t(u,null,f(n.v$.form.username.$errors,(e,a)=>(o(),t("li",{class:"text-red-500",key:a},m(e.$message),1))),128))])):g("",!0)]),s("div",null,[r(v,{value:"Correo electrónico"}),r(y,{modelValue:i.form.email,"onUpdate:modelValue":l[3]||(l[3]=e=>i.form.email=e),type:"email",class:k(["mt-1 block w-full",{"border-red-500":n.v$.form.email.$error}]),required:"",autocomplete:"off"},null,8,["modelValue","class"]),n.v$.form.email.$error?(o(),t("ul",ue,[(o(!0),t(u,null,f(n.v$.form.email.$errors,(e,a)=>(o(),t("li",{class:"text-red-500",key:a},m(e.$message),1))),128))])):g("",!0)]),s("div",fe,[s("label",pe,[r(w,{checked:i.form.change_password,"onUpdate:checked":l[4]||(l[4]=e=>i.form.change_password=e),name:"change_password"},null,8,["checked"]),_e])]),i.form.change_password?(o(),t(u,{key:0},[s("div",null,[r(v,{value:"Contraseña"}),r(y,{modelValue:i.form.password,"onUpdate:modelValue":l[5]||(l[5]=e=>i.form.password=e),type:"password",class:k(["mt-1 block w-full",{"border-red-500":n.v$.form.password.$error}]),required:"",autocomplete:"off"},null,8,["modelValue","class"]),n.v$.form.password.$error?(o(),t("ul",he,[(o(!0),t(u,null,f(n.v$.form.password.$errors,(e,a)=>(o(),t("li",{class:"text-red-500",key:a},m(e.$message),1))),128))])):g("",!0)]),s("div",null,[r(v,{value:"Confirmar Contraseña"}),r(y,{modelValue:i.form.confirm_password,"onUpdate:modelValue":l[6]||(l[6]=e=>i.form.confirm_password=e),type:"password",class:k(["mt-1 block w-full",{"border-red-500":n.v$.form.confirm_password.$error}]),required:"",autocomplete:"off"},null,8,["modelValue","class"]),n.v$.form.confirm_password.$error?(o(),t("ul",xe,[(o(!0),t(u,null,f(n.v$.form.confirm_password.$errors,(e,a)=>(o(),t("li",{class:"text-red-500",key:a},m(e.$message),1))),128))])):g("",!0)])],64)):g("",!0),s("fieldset",ge,[ve,s("div",we,[(o(!0),t(u,null,f(p.roles,e=>(o(),t("div",ke,[r(w,{checked:i.form.roles,"onUpdate:checked":l[7]||(l[7]=a=>i.form.roles=a),value:e.name},null,8,["checked","value"]),s("div",ye,m(e.name),1)]))),256))]),n.v$.form.roles.$error?(o(),t("ul",be,[(o(!0),t(u,null,f(n.v$.form.roles.$errors,(e,a)=>(o(),t("li",{class:"text-red-500",key:a},m(e.$message),1))),128))])):g("",!0)]),s("fieldset",Ce,[Me,s("div",Re,[(o(!0),t(u,null,f(p.permissions,e=>(o(),t("div",Ve,[r(w,{checked:i.form.permissions,"onUpdate:checked":l[8]||(l[8]=a=>i.form.permissions=a),value:e.name},null,8,["checked","value"]),s("div",Be,m(e.name),1)]))),256))]),n.v$.form.permissions.$error?(o(),t("ul",Ae,[(o(!0),t(u,null,f(n.v$.form.permissions.$errors,(e,a)=>(o(),t("li",{class:"text-red-500",key:a},m(e.$message),1))),128))])):g("",!0)])]),r(R,{onClick:_.updateUser,class:"mt-5"},{default:c(()=>[x(" Actualizar ")]),_:1},8,["onClick"])]),s("div",Ue,[s("table",$e,[s("thead",Le,[qe,s("tr",null,[s("th",Ie,[r(B,{class:"mr-2",onClick:_.openReportModal},{default:c(()=>[r(V,{icon:["far","pen-to-square"],class:"mr-1"}),x(" Modificar reportes ")]),_:1},8,["onClick"])]),ze,Fe,Se])]),s("tbody",De,[(o(!0),t(u,null,f(p.user.reports,e=>(o(),t("tr",null,[s("td",Ee,[s("div",Pe,[r(B,{class:"mr-2",onClick:a=>_.openFilterModal(e.id,e.filters)},{default:c(()=>[r(V,{icon:["fas","filter"],class:"mr-1"}),x(" Filtros ")]),_:2},1032,["onClick"])])]),s("td",Ne,[r(w,{onChange:a=>_.updateShowDashboard(e.id,!e.pivot.show),value:e.pivot.show,checked:e.pivot.show===1},null,8,["onChange","value","checked"])]),s("td",Oe,m(e.name),1),s("td",Te,[e.filters.length>0?(o(!0),t(u,{key:0},f(e.filters,(a,L)=>(o(),t("span",{class:k(["text-xs font-semibold inline-block py-1 px-2 rounded text-green-600 bg-green-200 uppercase last:mr-0 mr-1",{"ml-1":L>0}])},m(a.name),3))),256)):(o(),t("span",je," Ningún filtro agregado "))])]))),256))])])])])])])]),r(U,{show:i.filterModal.open,onClose:_.closeModal},{title:c(()=>[x(" Filtros "+m(p.reports.find(e=>e.id===i.filterModal.form.report_id).name),1)]),content:c(()=>[s("div",Ge,[(o(!0),t(u,null,f(p.filters,e=>(o(),t("div",He,[r(w,{checked:i.filterModal.form.filters,"onUpdate:checked":l[9]||(l[9]=a=>i.filterModal.form.filters=a),value:e.id},null,8,["checked","value"]),s("div",Je,m(e.name),1)]))),256))])]),footer:c(()=>[r(A,{onClick:_.closeModal},{default:c(()=>[x(" Cancelar ")]),_:1},8,["onClick"]),r(R,{class:"ml-3",onClick:_.updateFilter},{default:c(()=>[x(" Actualizar ")]),_:1},8,["onClick"])]),_:1},8,["show","onClose"]),r(U,{show:i.reportModal.open,onClose:_.closeModal},{title:c(()=>[x(" Modificar reportes ")]),content:c(()=>[s("div",Ke,[(o(!0),t(u,null,f(p.reports,e=>(o(),t("div",Qe,[r(w,{checked:i.reportModal.form.reports,"onUpdate:checked":l[10]||(l[10]=a=>i.reportModal.form.reports=a),value:e.id},null,8,["checked","value"]),s("div",We,m(e.name),1)]))),256))])]),footer:c(()=>[r(A,{onClick:_.closeModal},{default:c(()=>[x(" Cancelar ")]),_:1},8,["onClick"]),r(R,{class:"ml-3",onClick:_.updateReports},{default:c(()=>[x(" Actualizar ")]),_:1},8,["onClick"])]),_:1},8,["show","onClose"])]),_:1},8,["title"])}const ms=W(X,[["render",Xe]]);export{ms as default};
