import{_ as q}from"./AppLayout-e4602613.js";import{_ as I}from"./TextInput-d2ca2587.js";import{_ as z}from"./Checkbox-089d8d29.js";import{_ as F}from"./InputLabel-2d443a13.js";import{u as E,a as C,e as P,r as M,m as b,s as S}from"./i18n-validators-877ff800.js";import{i as D,k as N,I as h,o,c as O,w as c,a as s,t as m,b as r,n as w,e as t,F as u,h as f,f as g,g as x}from"./app-b06eca24.js";import{_ as T}from"./CustomButton-4a61b68d.js";import{a as j}from"./DialogModal-22603a1a.js";import{_ as G}from"./SecondaryButton-1060d753.js";import{_ as H}from"./PrimaryButton-5d93b565.js";import J from"./Report-dbacc800.js";import{_ as K}from"./_plugin-vue_export-helper-c27b6911.js";import"./DangerButton-b92a3342.js";const Q={computed:{report(){return J}},setup(){return{v$:E()}},components:{PrimaryButton:H,SecondaryButton:G,DialogModal:j,FontAwesomeIcon:D,CustomButton:T,Link:N,InputLabel:F,Checkbox:z,TextInput:I,AppLayout:q},props:{user:Object,roles:Array,permissions:Array,reports:Array,filters:Array},validations(){return{form:{id:{required:C},name:{required:C},username:{required:C},email:{required:C,email:P},password:{requiredIf:M(this.form.change_password),minLength:b(8)},confirm_password:{requiredIf:M(this.form.change_password),sameAs:S(this.form.password),minLength:b(8)},reports:{minLength:b(1)},permissions:{requiredIf:M(this.form.roles.length<1),minLength:b(1)},roles:{requiredIf:M(this.form.permissions.length<1),minLength:b(1)}}}},data(){return{form:{id:this.user.id,name:this.user.name,username:this.user.username,email:this.user.email,change_password:!1,password:"",confirm_password:"",reports:[],permissions:this.user.permissions.map(d=>d.name),roles:this.user.roles.map(d=>d.name)},filterModal:{open:!1,form:{user_id:"",report_id:"",filters:[]}},reportModal:{open:!1,form:{user_id:"",reports:[]}}}},methods:{openFilterModal(d,i){this.filterModal={open:!0,form:{user_id:this.user.id,report_id:d,filters:i.map(p=>p.id)}}},closeModal(){this.filterModal={open:!1,form:{user_id:"",report_id:"",filters:[]}},this.reportModal={open:!1,form:{user_id:"",reports:[]}}},updateFilter(){axios.post(route("user.report.update-filters"),this.filterModal.form).then(()=>{this.$swal({icon:"success",title:"Actualizado",text:"Filtros actualizados con éxito",toast:!0,position:"top-end",showConfirmButton:!1,timer:5e3,timerProgressBar:!0}),this.closeModal(),this.$inertia.visit(route("users.show",this.user.id))}).catch(d=>{this.$swal({icon:"error",title:"ERROR",text:d.response.data})})},openReportModal(){this.reportModal={open:!0,form:{user_id:this.user.id,reports:this.user.reports.map(d=>d.id)}}},updateReports(){axios.post(route("user.update-reports"),this.reportModal.form).then(()=>{this.$swal({icon:"success",title:"Actualizado",text:"Reportes actualizados con éxito",toast:!0,position:"top-end",showConfirmButton:!1,timer:5e3,timerProgressBar:!0}),this.closeModal(),this.$inertia.visit(route("users.show",this.user.id))}).catch(d=>{this.$swal({icon:"error",title:"ERROR",text:d.response.data})})},updateUser(){this.v$.form.$touch(),this.v$.form.$invalid?this.$swal({icon:"error",title:"ERROR",text:"Verifica que toda la información este correctamente diligenciada"}):axios.put(route("users.update",this.form.id),this.form).then(()=>{this.$swal({icon:"success",title:"Usuario Actualizado",text:"Usuario actualizado con éxito",toast:!0,position:"top-end",showConfirmButton:!1,timer:5e3,timerProgressBar:!0}),this.$inertia.visit(route("users.show",this.user.id))}).catch(d=>{this.$swal({icon:"error",title:"ERROR",text:d.response.data})})},updateShowDashboard(d,i){axios.post(route("user.report.set-default"),{user_id:this.user.id,report_id:d,state:i}).then(()=>{this.$swal({icon:"success",title:"Actualizado",text:"Reporte actualizado con exito",toast:!0,position:"top-end",showConfirmButton:!1,timer:5e3,timerProgressBar:!0}),this.$inertia.visit(route("users.show",this.user.id),{preserveScroll:!0})}).catch(p=>{this.$swal({icon:"error",title:"ERROR",text:p.response.data})})}}},W={class:"flex flex-row"},X={class:"font-semibold text-xl text-gray-800 leading-tight"},Y={class:"py-12"},Z={class:"max-w-8xl mx-6 sm:px-6 lg:px-8"},ee={class:"overflow-x-auto sm:-mx-6 lg:-mx-8"},se={class:"py-2 align-middle inline-block min-w-full"},oe={class:"shadow overflow-hidden border-b border-gray-200 sm:rounded-lg bg-white p-5"},te={class:"grid grid-cols-3 gap-5"},re={key:0,class:"mt-1"},le={key:0,class:"mt-1"},ie={key:0,class:"mt-1"},ae={class:"block"},ne={class:"flex items-center"},de=s("span",{class:"ml-2 text-sm text-gray-600"},"Cambiar contraseña",-1),ce={key:0,class:"mt-1"},me={key:0,class:"mt-1"},ue={class:"border rounded-lg p-4 col-span-3"},fe=s("legend",null,"Roles disponibles",-1),pe={class:"grid grid-cols-5 gap-5"},_e={class:"flex items-center"},he={class:"ml-2"},xe={key:0,class:"mt-1"},ge={class:"border rounded-lg p-4 col-span-3"},ve=s("legend",null,"Permisos disponibles",-1),we={class:"grid grid-cols-5 gap-5"},ke={class:"flex items-center"},ye={class:"ml-2"},be={key:0,class:"mt-1"},Ce={class:"shadow overflow-hidden border-b border-gray-200 sm:rounded-lg mt-5 bg-white"},Me={class:"min-w-full divide-y divide-gray-200"},Re={class:"bg-gray-50"},Be=s("tr",{class:"border-b"},[s("th",{scope:"col",colspan:"3",class:"px-6 py-3 text-left text-sm font-medium text-gray-500 uppercase tracking-wider"}," Reportes ")],-1),Ve={scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},Ae=s("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Mostrar en dashboard ",-1),$e=s("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Reporte ",-1),Ue=s("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Filtros ",-1),Le={class:"bg-white divide-y divide-gray-200"},qe={class:"px-6 py-4 text-center text-sm font-medium"},Ie={class:"flex flex-row"},ze={class:"px-6 py-4 text-left text-sm font-medium"},Fe={class:"px-6 py-4 text-left text-sm font-medium"},Ee={class:"px-6 py-4 text-left text-sm font-medium"},Pe={key:1,class:"text-xs font-semibold inline-block py-1 px-2 rounded text-red-600 bg-red-200 uppercase last:mr-0 mr-1"},Se={class:"grid grid-cols-2 gap-5"},De={class:"flex items-center"},Ne={class:"ml-2"},Oe={class:"grid grid-cols-2 gap-5"},Te={class:"flex items-center"},je={class:"ml-2"};function Ge(d,i,p,n,a,_){const k=h("InputLabel"),y=h("TextInput"),v=h("Checkbox"),R=h("PrimaryButton"),B=h("font-awesome-icon"),V=h("CustomButton"),A=h("SecondaryButton"),$=h("DialogModal"),U=h("AppLayout");return o(),O(U,{title:`Editar usuario ${p.user.name}`},{header:c(()=>[s("div",W,[s("h2",X," Editar usuario "+m(p.user.name),1)])]),default:c(()=>[s("div",Y,[s("div",Z,[s("div",ee,[s("div",se,[s("div",oe,[s("div",te,[s("div",null,[r(k,{value:"Nombre"}),r(y,{modelValue:a.form.name,"onUpdate:modelValue":i[0]||(i[0]=e=>a.form.name=e),type:"text",class:w(["mt-1 block w-full",{"border-red-500":n.v$.form.name.$error}]),required:"",autocomplete:"off"},null,8,["modelValue","class"]),n.v$.form.name.$error?(o(),t("ul",re,[(o(!0),t(u,null,f(n.v$.form.name.$errors,(e,l)=>(o(),t("li",{class:"text-red-500",key:l},m(e.$message),1))),128))])):g("",!0)]),s("div",null,[r(k,{value:"Usuario"}),r(y,{modelValue:a.form.username,"onUpdate:modelValue":i[1]||(i[1]=e=>a.form.username=e),type:"text",class:w(["mt-1 block w-full",{"border-red-500":n.v$.form.username.$error}]),required:"",autocomplete:"off"},null,8,["modelValue","class"]),n.v$.form.username.$error?(o(),t("ul",le,[(o(!0),t(u,null,f(n.v$.form.username.$errors,(e,l)=>(o(),t("li",{class:"text-red-500",key:l},m(e.$message),1))),128))])):g("",!0)]),s("div",null,[r(k,{value:"Correo electrónico"}),r(y,{modelValue:a.form.email,"onUpdate:modelValue":i[2]||(i[2]=e=>a.form.email=e),type:"email",class:w(["mt-1 block w-full",{"border-red-500":n.v$.form.email.$error}]),required:"",autocomplete:"off"},null,8,["modelValue","class"]),n.v$.form.email.$error?(o(),t("ul",ie,[(o(!0),t(u,null,f(n.v$.form.email.$errors,(e,l)=>(o(),t("li",{class:"text-red-500",key:l},m(e.$message),1))),128))])):g("",!0)]),s("div",ae,[s("label",ne,[r(v,{checked:a.form.change_password,"onUpdate:checked":i[3]||(i[3]=e=>a.form.change_password=e),name:"change_password"},null,8,["checked"]),de])]),a.form.change_password?(o(),t(u,{key:0},[s("div",null,[r(k,{value:"Contraseña"}),r(y,{modelValue:a.form.password,"onUpdate:modelValue":i[4]||(i[4]=e=>a.form.password=e),type:"password",class:w(["mt-1 block w-full",{"border-red-500":n.v$.form.password.$error}]),required:"",autocomplete:"off"},null,8,["modelValue","class"]),n.v$.form.password.$error?(o(),t("ul",ce,[(o(!0),t(u,null,f(n.v$.form.password.$errors,(e,l)=>(o(),t("li",{class:"text-red-500",key:l},m(e.$message),1))),128))])):g("",!0)]),s("div",null,[r(k,{value:"Confirmar Contraseña"}),r(y,{modelValue:a.form.confirm_password,"onUpdate:modelValue":i[5]||(i[5]=e=>a.form.confirm_password=e),type:"password",class:w(["mt-1 block w-full",{"border-red-500":n.v$.form.confirm_password.$error}]),required:"",autocomplete:"off"},null,8,["modelValue","class"]),n.v$.form.confirm_password.$error?(o(),t("ul",me,[(o(!0),t(u,null,f(n.v$.form.confirm_password.$errors,(e,l)=>(o(),t("li",{class:"text-red-500",key:l},m(e.$message),1))),128))])):g("",!0)])],64)):g("",!0),s("fieldset",ue,[fe,s("div",pe,[(o(!0),t(u,null,f(p.roles,e=>(o(),t("div",_e,[r(v,{checked:a.form.roles,"onUpdate:checked":i[6]||(i[6]=l=>a.form.roles=l),value:e.name},null,8,["checked","value"]),s("div",he,m(e.name),1)]))),256))]),n.v$.form.roles.$error?(o(),t("ul",xe,[(o(!0),t(u,null,f(n.v$.form.roles.$errors,(e,l)=>(o(),t("li",{class:"text-red-500",key:l},m(e.$message),1))),128))])):g("",!0)]),s("fieldset",ge,[ve,s("div",we,[(o(!0),t(u,null,f(p.permissions,e=>(o(),t("div",ke,[r(v,{checked:a.form.permissions,"onUpdate:checked":i[7]||(i[7]=l=>a.form.permissions=l),value:e.name},null,8,["checked","value"]),s("div",ye,m(e.name),1)]))),256))]),n.v$.form.permissions.$error?(o(),t("ul",be,[(o(!0),t(u,null,f(n.v$.form.permissions.$errors,(e,l)=>(o(),t("li",{class:"text-red-500",key:l},m(e.$message),1))),128))])):g("",!0)])]),r(R,{onClick:_.updateUser,class:"mt-5"},{default:c(()=>[x(" Actualizar ")]),_:1},8,["onClick"])]),s("div",Ce,[s("table",Me,[s("thead",Re,[Be,s("tr",null,[s("th",Ve,[r(V,{class:"mr-2",onClick:_.openReportModal},{default:c(()=>[r(B,{icon:["far","pen-to-square"],class:"mr-1"}),x(" Modificar reportes ")]),_:1},8,["onClick"])]),Ae,$e,Ue])]),s("tbody",Le,[(o(!0),t(u,null,f(p.user.reports,e=>(o(),t("tr",null,[s("td",qe,[s("div",Ie,[r(V,{class:"mr-2",onClick:l=>_.openFilterModal(e.id,e.filters)},{default:c(()=>[r(B,{icon:["fas","filter"],class:"mr-1"}),x(" Filtros ")]),_:2},1032,["onClick"])])]),s("td",ze,[r(v,{onChange:l=>_.updateShowDashboard(e.id,!e.pivot.show),value:e.pivot.show,checked:e.pivot.show===1},null,8,["onChange","value","checked"])]),s("td",Fe,m(e.name),1),s("td",Ee,[e.filters.length>0?(o(!0),t(u,{key:0},f(e.filters,(l,L)=>(o(),t("span",{class:w(["text-xs font-semibold inline-block py-1 px-2 rounded text-green-600 bg-green-200 uppercase last:mr-0 mr-1",{"ml-1":L>0}])},m(l.name),3))),256)):(o(),t("span",Pe," Ningún filtro agregado "))])]))),256))])])])])])])]),r($,{show:a.filterModal.open,onClose:_.closeModal},{title:c(()=>[x(" Filtros "+m(p.reports.find(e=>e.id===a.filterModal.form.report_id).name),1)]),content:c(()=>[s("div",Se,[(o(!0),t(u,null,f(p.filters,e=>(o(),t("div",De,[r(v,{checked:a.filterModal.form.filters,"onUpdate:checked":i[8]||(i[8]=l=>a.filterModal.form.filters=l),value:e.id},null,8,["checked","value"]),s("div",Ne,m(e.name),1)]))),256))])]),footer:c(()=>[r(A,{onClick:_.closeModal},{default:c(()=>[x(" Cancelar ")]),_:1},8,["onClick"]),r(R,{class:"ml-3",onClick:_.updateFilter},{default:c(()=>[x(" Actualizar ")]),_:1},8,["onClick"])]),_:1},8,["show","onClose"]),r($,{show:a.reportModal.open,onClose:_.closeModal},{title:c(()=>[x(" Modificar reportes ")]),content:c(()=>[s("div",Oe,[(o(!0),t(u,null,f(p.reports,e=>(o(),t("div",Te,[r(v,{checked:a.reportModal.form.reports,"onUpdate:checked":i[9]||(i[9]=l=>a.reportModal.form.reports=l),value:e.id},null,8,["checked","value"]),s("div",je,m(e.name),1)]))),256))])]),footer:c(()=>[r(A,{onClick:_.closeModal},{default:c(()=>[x(" Cancelar ")]),_:1},8,["onClick"]),r(R,{class:"ml-3",onClick:_.updateReports},{default:c(()=>[x(" Actualizar ")]),_:1},8,["onClick"])]),_:1},8,["show","onClose"])]),_:1},8,["title"])}const ls=K(Q,[["render",Ge]]);export{ls as default};
